   1:			;z80dasm: Portable Z80 disassembler
   2:			;Copyright (C) Marcel de Kogel 1996,1997
   3:			;Patched 2006 for uppercase by Piergiorgio Betti <pbetti@lpconsul.net>
   4:			
   5:			; link to DarkStar Monitor symbols...
   6:			include darkstar.equ
**** darkstar.equ ****
   1:			;****** Equ's file autogenerated by genequs ver: 1.0
   2:			;****** Input files:
   3:			;****** SysCommon.lst
   4:	FE76          	TX0            	EQU	0FE76H
   5:	FDC4          	FIN            	EQU	0FDC4H
   6:	FE78          	TX01           	EQU	0FE78H
   7:	FD89          	DLY1           	EQU	0FD89H
   8:	FD87          	DLY2           	EQU	0FD87H
   9:	FDE1          	FOUT           	EQU	0FDE1H
  10:	FE64          	U1NUL          	EQU	0FE64H
  11:	FE25          	U0ISR          	EQU	0FE25H
  12:	FE5B          	U1ISR          	EQU	0FE5BH
  13:	FD85          	DELAY          	EQU	0FD85H
  14:	FE50          	UISRE          	EQU	0FE50H
  15:	FDB5          	FSTAT          	EQU	0FDB5H
  16:	FE35          	UISRI          	EQU	0FE35H
  17:	FE6E          	DOSTX          	EQU	0FE6EH
  18:	FC4B          	BBU1ST         	EQU	0FC4BH
  19:	FC45          	BBU1RX         	EQU	0FC45H
  20:	FC3F          	BBU1TX         	EQU	0FC3FH
  21:	FD29          	BBEXEC         	EQU	0FD29H
  22:	FCFF          	BBHDRD         	EQU	0FCFFH
  23:	FD6A          	BBVOID         	EQU	0FD6AH
  24:	FE91          	UASTKB         	EQU	0FE91H
  25:	FD6B          	MMPMAP         	EQU	0FD6BH
  26:	FE0F          	INTRDI         	EQU	0FE0FH
  27:	FC2D          	SCONIN         	EQU	0FC2DH
  28:	FC15          	VCONIN         	EQU	0FC15H
  29:	FCDB          	BBDIV16        	EQU	0FCDBH
  30:	FCF9          	BBHDWR         	EQU	0FCF9H
  31:	FD78          	MMGETP         	EQU	0FD78H
  32:	FDFE          	INTREN         	EQU	0FDFEH
  33:	FE84          	RLDROM         	EQU	0FE84H
  34:	FCE1          	BBMUL16        	EQU	0FCE1H
  35:	FC00          	SYSCOM         	EQU	0FC00H
  36:	FE8F          	UASTAV         	EQU	0FE8FH
  37:	FE19          	SYTIMR         	EQU	0FE19H
  38:	FC33          	SCONST         	EQU	0FC33H
  39:	FC1B          	VCONST         	EQU	0FC1BH
  40:	FE6C          	SRXRSM         	EQU	0FE6CH
  41:	FE68          	SRXSTP         	EQU	0FE68H
  42:	FC39          	BBU0INI        	EQU	0FC39H
  43:	FC51          	BBU1INI        	EQU	0FC51H
  44:	FC87          	BBFREAD        	EQU	0FC87H
  45:	FD23          	BBEIDCK        	EQU	0FD23H
  46:	FD05          	BBHDGEO        	EQU	0FD05H
  47:	FEBF          	BBSTACK        	EQU	0FEBFH
  48:	FC81          	BBFHOME        	EQU	0FC81H
  49:	FD94          	BBCONIN        	EQU	0FD94H
  50:	FC27          	CRDUREG        	EQU	0FC27H
  51:	FFF0          	SINTVEC        	EQU	0FFF0H
  52:	FEBF          	SYSCMLO        	EQU	0FEBFH
  53:	FE22          	VOIDISR        	EQU	0FE22H
  54:	FC9F          	BBSTTIM        	EQU	0FC9FH
  55:	FDAA          	BBCONST        	EQU	0FDAAH
  56:	FC27          	SCONOUT        	EQU	0FC27H
  57:	FC0F          	VCONOUT        	EQU	0FC0FH
  58:	FCE7          	BBOFFCAL       	EQU	0FCE7H
  59:	FC57          	BBINICTC       	EQU	0FC57H
  60:	FE9B          	BBSTBASE       	EQU	0FE9BH
  61:	FC5D          	BBRESCTC       	EQU	0FC5DH
  62:	FCA5          	BBRDTIME       	EQU	0FCA5H
  63:	FD5A          	BBCALRET       	EQU	0FD5AH
  64:	FCB7          	BBDMASET       	EQU	0FCB7H
  65:	FC00          	BBJTOBNK       	EQU	0FC00H
  66:	FCBD          	BBDSKSEL       	EQU	0FCBDH
  67:	FCED          	BBHDINIT       	EQU	0FCEDH
  68:	FCB1          	BBSECSET       	EQU	0FCB1H
  69:	FD0B          	BBHDBOOT       	EQU	0FD0BH
  70:	FC69          	BBUPLCHR       	EQU	0FC69H
  71:	FC99          	BBPRNCHR       	EQU	0FC99H
  72:	FCC9          	BBVCPMBT       	EQU	0FCC9H
  73:	FC93          	BBFLOPIO       	EQU	0FC93H
  74:	FD1D          	BBEPMNGR       	EQU	0FD1DH
  75:	FCCF          	BBSIDSET       	EQU	0FCCFH
  76:	FD11          	BBLDPART       	EQU	0FD11H
  77:	FC75          	BBRDVDSK       	EQU	0FC75H
  78:	FC8D          	BBFWRITE       	EQU	0FC8DH
  79:	FCC3          	BBCPBOOT       	EQU	0FCC3H
  80:	FC21          	BBCURSET       	EQU	0FC21H
  81:	FCAB          	BBTRKSET       	EQU	0FCABH
  82:	FC7B          	BBWRVDSK       	EQU	0FC7BH
  83:	FD9F          	BBCONOUT       	EQU	0FD9FH
  84:	FCF3          	BBDRIVEID      	EQU	0FCF3H
  85:	FC63          	BBPSNDBLK      	EQU	0FC63H
  86:	FC03          	BBCRTCINI      	EQU	0FC03H
  87:	FC6F          	BBPRCVBLK      	EQU	0FC6FH
  88:	FC09          	BBCRTFILL      	EQU	0FC09H
  89:	FCD5          	BBFDRVSEL      	EQU	0FCD5H
  90:	FD17          	BBDPRMSET      	EQU	0FD17H
  91:			;****** EOF ***
  92:			
**** format.asm ****
   7:			
   8:			
   9:	000D          	CR	EQU	$0D
  10:	000A          	LF	EQU	$0A
  11:	005C          	FCB1	EQU	$005C			; DEFAULT FCB STRUCTURE
  12:	004E          	DRVSLBF	EQU	$004E
  13:	0100          	TPA	EQU	$0100
  14:			
  15:	0100          		ORG	TPA
  16:			
  17:	0100  C36902  		JP	FORMAT			; 000100 the beginning
  18:			
  19:				; Here is the data to compose the track
  20:	0103  FFFFFFFF	FTRBEG:	DEFB	$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
	      FFFFFFFF
	      FFFF
  21:	010D  FFFFFFFF		DEFB	$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
	      FFFFFFFF
	      FFFF
  22:	0117  FFFFFFFF		DEFB	$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
	      FFFFFFFF
	      FFFF
  23:	0121  FFFFFFFF		DEFB	$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
	      FFFFFFFF
	      FFFF
  24:			
  25:	012B  00000000	FTRBG2:	DEFB	$00,$00,$00,$00,$00,$00
	      0000
  26:	0131  FE      		DEFB	$FE					; addr mark
  27:	0132  00      	FITRKN:	DEFB	$00					; track #
  28:	0133  00      		DEFB	$00					;
  29:	0134  00      	FISECN:	DEFB	$00					; sector #
  30:	0135  00      		DEFB	$00
  31:	0136  F7      		DEFB	$F7					; CRC mark
  32:	0137  FFFFFFFF		DEFB	$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
	      FFFFFFFF
	      FFFF
  33:	0141  FF      		DEFB	$FF
  34:	0142  00000000		DEFB	$00,$00,$00,$00,$00,$00
	      0000
  35:	0148  FB      		DEFB	$FB					; data addr mark
  36:	0149  E5E5E5E5		DEFB	$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5
	      E5E5E5E5
  37:	0151  E5E5E5E5		DEFB	$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5
	      E5E5E5E5
  38:	0159  E5E5E5E5		DEFB	$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5
	      E5E5E5E5
  39:	0161  E5E5E5E5		DEFB	$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5
	      E5E5E5E5
  40:	0169  E5E5E5E5		DEFB	$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5
	      E5E5E5E5
  41:	0171  E5E5E5E5		DEFB	$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5
	      E5E5E5E5
  42:	0179  E5E5E5E5		DEFB	$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5
	      E5E5E5E5
  43:	0181  E5E5E5E5		DEFB	$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5
	      E5E5E5E5
  44:	0189  E5E5E5E5		DEFB	$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5
	      E5E5E5E5
  45:	0191  E5E5E5E5		DEFB	$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5
	      E5E5E5E5
  46:	0199  E5E5E5E5		DEFB	$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5
	      E5E5E5E5
  47:	01A1  E5E5E5E5		DEFB	$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5
	      E5E5E5E5
  48:	01A9  E5E5E5E5		DEFB	$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5
	      E5E5E5E5
  49:	01B1  E5E5E5E5		DEFB	$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5
	      E5E5E5E5
  50:	01B9  E5E5E5E5		DEFB	$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5
	      E5E5E5E5
  51:	01C1  E5E5E5E5		DEFB	$E5,$E5,$E5,$E5,$E5,$E5,$E5,$E5
	      E5E5E5E5
  52:	01C9  F7      		DEFB	$F7					; CRC mark
  53:	01CA  FFFFFFFF		DEFB	$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
	      FFFFFFFF
	      FFFF
  54:	01D4  FFFFFFFF		DEFB	$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
	      FFFFFFFF
	      FFFF
  55:			
  56:	01DE          	UUSD1	EQU	$			; should be $01de
  57:	01DE  FFFFFFFF		DEFB	$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
	      FFFFFFFF
	      FFFF
  58:	01E8  FFFFFFFF		DEFB	$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
	      FFFFFFFF
	      FFFF
  59:	01F2  FFFFFFFF		DEFB	$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
	      FFFFFFFF
	      FFFF
  60:	01FC  FFFFFFFF		DEFB	$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
	      FFFFFFFF
	      FFFF
  61:	0206  FFFFFFFF		DEFB	$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
	      FFFFFFFF
	      FFFF
  62:	0210  FFFFFFFF		DEFB	$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
	      FFFFFFFF
	      FFFF
  63:	021A  FFFFFFFF		DEFB	$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
	      FFFFFFFF
	      FFFF
  64:	0224  FFFFFFFF		DEFB	$FF,$FF,$FF,$FF,$FF
	      FF
  65:	0229  85FCDEFB		DEFB	$85,$FC,$DE,$FB,$00,$00,$5D,$00,$0D
	      00005D00
	      0D
  66:	0232  00622000		DEFB	$00,$62,$20,$00,$00,$AC,$02
	      00AC02
  67:			
  68:	0239          	CODBEG	EQU	$			; begin code...
  69:				; Show a zero terminated string
  70:	0239          	ZSDSPCL:				; 0239
  71:	0239  0E0D    		LD	C,CR			;
  72:	023B  CD0000  		CALL	JCONOU			; send CR
U Undeclared error
  73:	023E  0E0A    		LD	C,LF			;
  74:	0240  C30000  		JP	JCONOU			; send LF
U Undeclared error
  75:	0243  7E      	ZSDSP:	LD	A,(HL)			; pick char pointed by HL
  76:	0244  B7      		OR	A			; is the terminating NUL ?
  77:	0245  C8      		RET	Z			; yes
  78:	0246  E5      		PUSH	HL			; no
  79:	0247  4F      		LD	C,A			;
  80:	0248  CD0000  		CALL	JCONOU			; display it
U Undeclared error
  81:	024B  E1      		POP	HL			;
  82:	024C  23      		INC	HL			;
  83:	024D  C34302  		JP	ZSDSP			;
  84:			
  85:				; get user input
  86:	0250          	GCHR:
  87:	0250  CD0000  		CALL	JCONIN			; take from console
U Undeclared error
  88:	0253  E67F    		AND	$7F			;
  89:	0255  FE60    		CP	$60			;
  90:	0257  FA6102  		JP	M,GCDSP			; verify alpha
  91:	025A  FE7B    		CP	$7B			;
  92:	025C  F26102  		JP	P,GCDSP			;
  93:	025F  CBAF    		RES	5,A			;
  94:	0261  C5      	GCDSP:	PUSH	BC			;
  95:	0262  4F      		LD	C,A			;
  96:	0263  CD0000  		CALL	JCONOU			;
U Undeclared error
  97:	0266  79      		LD	A,C			;
  98:	0267  C1      		POP	BC			;
  99:	0268  C9      		RET				;
 100:			
 101:	0269          	FORMAT:
 102:	0269  313902  		LD	SP,CODBEG		; init stack
 103:	026C  3E28    		LD	A,40			; 40 tracks by default
 104:	026E  325B04  		LD	(TNUMBF),A		;
 105:	0271  115D00  		LD	DE,FCB1+1		; point filename in FCB1
 106:	0274  1A      		LD	A,(DE)			;
 107:	0275  FE20    		CP	$20			; is space: no arguments
 108:	0277  CAA902  		JP	Z,NOARG			;
 109:	027A  210000  		LD	HL,$0000		; still checking...
 110:	027D  1A      	ARGLP:	LD	A,(DE)			;
 111:	027E  13      		INC	DE			;
 112:	027F  FE20    		CP	$20			; is space ?
 113:	0281  CA9C02  		JP	Z,SPNUL			; yes
 114:	0284  B7      		OR	A			; is NUL ?
 115:	0285  CA9C02  		JP	Z,SPNUL			; yes
 116:	0288  D630    		SUB	$30			; is ':' ?
 117:	028A  FE0A    		CP	LF			;
 118:	028C  D2B503  		JP	NC,ATRKERR		;
 119:	028F  29      		ADD	HL,HL			;
 120:	0290  E5      		PUSH	HL			;
 121:	0291  29      		ADD	HL,HL			;
 122:	0292  29      		ADD	HL,HL			;
 123:	0293  C1      		POP	BC			;
 124:	0294  09      		ADD	HL,BC			;
 125:	0295  4F      		LD	C,A			;
 126:	0296  0600    		LD	B,$00			;
 127:	0298  09      		ADD	HL,BC			;
 128:	0299  C37D02  		JP	ARGLP			;
 129:	029C  7C      	SPNUL:	LD	A,H			;
 130:	029D  B7      		OR	A			;
 131:	029E  C2B503  		JP	NZ,ATRKERR		;
 132:	02A1  7D      		LD	A,L			;
 133:	02A2  B7      		OR	A			;
 134:	02A3  CAB503  		JP	Z,ATRKERR		;
 135:	02A6  325B04  		LD	(TNUMBF),A		;
 136:	02A9  CD3902  	NOARG:	CALL	ZSDSPCL			;
 137:	02AC  210E04  		LD	HL,MFMT			; ask drive
 138:	02AF  CD4302  		CALL	ZSDSP			;
 139:	02B2  CD5002  		CALL	GCHR			;
 140:	02B5  FE03    		CP	$03			; CTRL+C ?
 141:	02B7  CA8403  		JP	Z,EXIT			; exit
 142:	02BA  FE0D    		CP	CR			; return ?
 143:	02BC  CA8403  		JP	Z,EXIT			; exit
 144:	02BF  CBAF    		RES	5,A			;
 145:	02C1  D641    		SUB	'A'			; sub 'A'
 146:	02C3  FA7E03  		JP	M,WRNGD			;
 147:	02C6  FE04    		CP	$04			; is in range 0-3
 148:	02C8  F27E03  		JP	P,WRNGD			; no
 149:	02CB  320000  		LD	(FDRVBUF),A		; store drive num
U Undeclared error
 150:	02CE  CD3902  		CALL	ZSDSPCL			;
 151:	02D1  214D04  		LD	HL,MCFM			; ask confirm
 152:	02D4  CD4302  		CALL	ZSDSP			;
 153:	02D7  CD5002  		CALL	GCHR			;
 154:	02DA  FE53    		CP	'S'			; is 'S' ?
 155:	02DC  C27503  		JP	NZ,WCMND		; no
 156:	02DF  0E49    		LD	C,'I'			; complete answer with 'I' (SI = YES)
 157:	02E1  CD0000  		CALL	JCONOU			;
U Undeclared error
 158:	02E4  0E0D    		LD	C,CR			;
 159:	02E6  CD0000  		CALL	JCONOU			;
U Undeclared error
 160:	02E9  3E00    		LD	A,$00			;
 161:	02EB  323201  		LD	(FITRKN),A		;
 162:	02EE  3C      		INC	A			;
 163:	02EF  323401  		LD	(FISECN),A		;
 164:			;	LD	HL,($0006)		; load BDOS start entry point
 165:			;					; that for the 56k is $CC06 and
 166:			;					; for 60k is $DC06
 167:			;	LD	DE,$0F02		; offset to $DB08/$EB08
 168:			;	ADD	HL,DE			;
 169:			;	LD	(CBDSEL+1),HL		; calc address of HDRVSEL in BIOS
 170:			;CBDSEL:	CALL	$0000			; call BIOS HDRVSEL
 171:	02F2  CDBE03  		CALL	HDRVSEL
 172:	02F5  3A4E00  		LD	A,(DRVSLBF)		;
 173:	02F8  CB6F    		BIT	5,A			; ibm-3740 ?
 174:	02FA  C28A03  		JP	NZ,WRNGT		; yes: unsupported
 175:	02FD  3E03    		LD	A,$03			; 1771 RESTORE
 176:	02FF  CD0000  		CALL	JFDCMD			;
U Undeclared error
 177:	0302  CD0000  		CALL	JFSTAT			;
U Undeclared error
 178:	0305  210301  	TRSTA:	LD	HL,FTRBEG		; start sequence
 179:	0308  0E00    		LD	C,FDCDATAREG		; set C to 1771 data port
U Undeclared error
 180:	030A  0628    		LD	B,40			; 40 bytes to send
 181:	030C  3EF4    		LD	A,$F4			; 1771 WRITE TRACK
 182:	030E  CD0000  		CALL	JFDCMD			;
U Undeclared error
 183:	0311  DB00    	WFDC:	IN	A,(FDCCMDSTATR)		; chek ready
U Undeclared error
 184:	0313  CB4F    		BIT	1,A			;
 185:	0315  28FA    		JR	Z,WFDC			;
 186:	0317  EDA3    		OUTI				; loop send byte
 187:	0319  20F6    		JR	NZ,WFDC			;
 188:	031B  212B01  	WSECD:	LD	HL,FTRBG2		; sector image
 189:	031E  06AD    		LD	B,173			; 173 bytes to send
 190:	0320  DB00    	WFDC1:	IN	A,(FDCCMDSTATR)		;
U Undeclared error
 191:	0322  CB4F    		BIT	1,A			;
 192:	0324  28FA    		JR	Z,WFDC1			;
 193:	0326  EDA3    		OUTI				;
 194:	0328  20F6    		JR	NZ,WFDC1		;
 195:	032A  3A3401  		LD	A,(FISECN)		;
 196:	032D  3C      		INC	A			;
 197:	032E  323401  		LD	(FISECN),A		;
 198:	0331  FE12    		CP	18			; if not all 17 sec image written
 199:	0333  C21B03  		JP	NZ,WSECD		; next sector
 200:	0336  DB00    	WTEAG:	IN	A,(FDCCMDSTATR)		; ready to write again ?
U Undeclared error
 201:	0338  CB47    		BIT	0,A			;
 202:	033A  CA4403  		JP	Z,WTEND			; no
 203:	033D  3EFF    		LD	A,$FF			; pad with FF
 204:	033F  D300    		OUT	(FDCDATAREG),A		;
U Undeclared error
 205:	0341  C33603  		JP	WTEAG			;
 206:	0344  CD0000  	WTEND:	CALL	JFSTAT			;
U Undeclared error
 207:	0347  E6E7    		AND	$E7			;
 208:	0349  C20000  		JP	NZ,JUSRCM		; very bad: return to monitor ......
U Undeclared error
 209:	034C  0E2E    		LD	C,'.'			;
 210:	034E  CD0000  		CALL	JCONOU			; print a '.' for the track
U Undeclared error
 211:	0351  3A3201  		LD	A,(FITRKN)		;
 212:	0354  3C      		INC	A			; next track
 213:	0355  215B04  		LD	HL,TNUMBF		;
 214:	0358  BE      		CP	(HL)			; EOD ?
 215:	0359  CAAE03  		JP	Z,RSTART		; yes
 216:	035C  323201  		LD	(FITRKN),A		;
 217:	035F  3E01    		LD	A,$01			;
 218:	0361  323401  		LD	(FISECN),A		;
 219:	0364  0600    		LD	B,$00			;
 220:	0366  10FE    	VL1:	DJNZ	VL1			; ?????? 000370 10 FE
 221:	0368  10FE    	VL2:	DJNZ	VL2			; ?????? 000372 10 FE
 222:	036A  3E53    		LD	A,$53			; 1771 STEP-IN
 223:	036C  CD0000  		CALL	JFDCMD			;
U Undeclared error
 224:	036F  CD0000  		CALL	JFSTAT			;
U Undeclared error
 225:	0372  C30503  		JP	TRSTA			;
 226:			
 227:	0375  213704  	WCMND:	LD	HL,MCMDA		; 00037F 21 2A 04
 228:			
 229:	0378  CD4302  	DSPER:	CALL	ZSDSP			;
 230:	037B  C3AE03  		JP	RSTART			;
 231:			
 232:	037E  21D503  	WRNGD:	LD	HL,MNDRV		;
 233:	0381  C37803  		JP	DSPER			;
 234:			
 235:	0384  CD3902  	EXIT:	CALL	ZSDSPCL			;
 236:	0387  C30000  		JP	$0000			; jump to BOOT
 237:			
 238:	038A  219303  	WRNGT:	LD	HL,MNTIP		;
 239:	038D  CD4302  		CALL	ZSDSP			;
 240:	0390  C3AE03  		JP	RSTART			;
 241:			
 242:	0393  0D0A7469	MNTIP:	DEFB	CR,LF,"tipo drive non ammesso",CR,LF,$00
	      706F2064
	      72697665
	      206E6F6E
	      20616D6D
	      6573736F
	      0D0A00
 243:			
 244:				; restart from beginning
 245:	03AE  3E00    	RSTART:	LD	A,$00			; reset drives
 246:	03B0  D300    		OUT	(FDCDRVRCNT),A		;
U Undeclared error
 247:	03B2  C36902  		JP	FORMAT			;
 248:			
 249:				; Display track # error
 250:	03B5          	ATRKERR:
 251:	03B5  21F003  		LD	HL,MNTRK		;
 252:	03B8  CD4302  		CALL	ZSDSP			;
 253:	03BB  C30000  		JP	$0000			;
 254:			
 255:				; Select and activate floppy drive
 256:	03BE          	HDRVSEL:
 257:	03BE  F5      		PUSH	AF			;
 258:	03BF  E5      		PUSH	HL			;
 259:	03C0  21D103  		LD	HL,HDRVV		;
 260:	03C3  3A0000  		LD	A,(FDRVBUF)		;
U Undeclared error
 261:	03C6  85      		ADD	A,L			;
 262:	03C7  6F      		LD	L,A			;
 263:	03C8  7E      		LD	A,(HL)			;
 264:	03C9  324E00  		LD	(DRVSLBF),A		;
 265:	03CC  D300    		OUT	(FDCDRVRCNT),A		;
U Undeclared error
 266:	03CE  E1      		POP	HL			;
 267:	03CF  F1      		POP	AF			;
 268:	03D0  C9      		RET				;
 269:			
 270:				; This used to translate the drive number in a cmd byte suitable
 271:				; for drive selection on the floppy board
 272:	03D1  01      	HDRVV:	DEFB	$01			; drive 1
 273:	03D2  02      		DEFB	$02			; drive 2
 274:	03D3  04      		DEFB	$04			; drive 3
 275:	03D4  08      		DEFB	$08 			; drive 4
 276:			
 277:	03D5  0D0A6E6F	MNDRV:	DEFB	CR,LF,"nome drive non ammesso",CR,LF,$00
	      6D652064
	      72697665
	      206E6F6E
	      20616D6D
	      6573736F
	      0D0A00
 278:	03F0  0D0A6E75	MNTRK:	DEFB	CR,LF,"numero tracce non ammesso",CR,LF,$00
	      6D65726F
	      20747261
	      63636520
	      6E6F6E20
	      616D6D65
	      73736F0D
	      0A00
 279:	040E  456C6574	MFMT:	DEFB	"Elettro Design FORMATTAZIONE DISCO 5",$22," ? ",$00
	      74726F20
	      44657369
	      676E2046
	      4F524D41
	      5454415A
	      494F4E45
	      20444953
	      434F2035
	      22203F20
	      00
 280:	0437  0D0A636F	MCMDA:	DEFB	CR,LF,"comando annullato",CR,LF,$00
	      6D616E64
	      6F20616E
	      6E756C6C
	      61746F0D
	      0A00
 281:	044D  73696375	MCFM:	DEFB	"sicuro s/n ? ",$00
	      726F2073
	      2F6E203F
	      2000
 282:			
 283:	045B  28      	TNUMBF:	DEFB	$28			; 00044E 28
 284:			
 285:	045C  00000000	UUSD2:	DEFB	$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
	      00000000
	      0000
 286:	0466  00000000		DEFB	$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
	      00000000
	      0000
 287:	0470  00000000		DEFB	$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
	      00000000
	      0000
 288:	047A  00000000		DEFB	$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
	      00000000
	      0000
 289:	0484  00000000		DEFB	$00,$00,$00,$00,$00,$00,$00,$00
	      00000000
 290:			
 291:				; This seem just junk 'til the EOF
 292:				;
 293:			; 	CP	$FF			; 000480 FE FF
 294:			; 	JP	NZ,$0BCF		; 000482 C2 CF 0B
 295:			; 	LD	A,C			; 000485 79
 296:			; 	OR	A			; 000486 B7
 297:			; 	JP	P,$0BCF			; 000487 F2 CF 0B
 298:			; 	LD	B,C			; 00048A 41
 299:			; 	LD	A,D			; 00048B 7A
 300:			; 	JP	$0299			; 00048C C3 99 02
 301:			; 	CALL	$00DC			; 00048F CD DC 00
 302:			; 	OR	B			; 000492 B0
 303:			; 	LD	C,E			; 000493 4B
 304:			; 	LD	B,D			; 000494 42
 305:			; 	CALL	$01F4			; 000495 CD F4 01
 306:			; 	LD	A,C			; 000498 79
 307:			; 	CALL	$01F4			; 000499 CD F4 01
 308:			; 	LD	A,B			; 00049C 78
 309:			; 	JP	$01F4			; 00049D C3 F4 01
 310:			; 	CALL	$00DC			; 0004A0 CD DC 00
 311:			; 	OR	B			; 0004A3 B0
 312:			; 	CALL	$01F4			; 0004A4 CD F4 01
 313:			; 	LD	A,C			; 0004A7 79
 314:			; 	CALL	$00A1			; 0004A8 CD A1 00
 315:			; 	JP	$0299			; 0004AB C3 99 02
 316:			; 	LD	C,$08			; 0004AE 0E 08
 317:			; 	LD	DE,$00F8		; 0004B0 11 F8 00
 318:			; 	LD	HL,$0D8A		; 0004B3 21 8A 0D
 319:			; 	CALL	$00FC			; 0004B6 CD FC 00
 320:			; 	JP	NZ,$02C5		; 0004B9 C2 C5 02
 321:			; 	LD	A,E			; 0004BC 7B
 322:			; 	CPL				; 0004BD 2F
 323:			; 	RLCA				; 0004BE 07
 324:			; 	RLCA				; 0004BF 07
 325:			; 	RLCA				; 0004C0 07
 326:			; 	RST	08H			; 0004C1 CF
 327:			; 	JP	$02E2			; 0004C2 C3 E2 02
 328:			; 	LD	DE,$00FD		; 0004C5 11 FD 00
 329:			; 	LD	C,$03			; 0004C8 0E 03
 330:			; 	LD	HL,$0D96		; 0004CA 21 96 0D
 331:			; 	CALL	$00FC			; 0004CD CD FC 00
 332:			; 	JP	NZ,$032E		; 0004D0 C2 2E 03
 333:			; 	LD	A,E			; 0004D3 7B
 334:			; 	CPL				; 0004D4 2F
 335:			; 	ADD	A,$01			; 0004D5 C6 01
 336:			; 	RRCA				; 0004D7 0F
 337:			; 	RRCA				; 0004D8 0F
 338:			; 	LD	C,A			; 0004D9 4F
 339:			; 	CALL	$0139			; 0004DA CD 39 01
 340:			; 	CALL	$00D6			; 0004DD CD D6 00
 341:			; 	OR	C			; 0004E0 B1
 342:			; 	LD	C,A			; 0004E1 4F
 343:			; 	CALL	$0156			; 0004E2 CD 56 01
 344:			; 	CP	$08			; 0004E5 FE 08
 345:			; 	JP	C,$0300			; 0004E7 DA 00 03
 346:			; 	SBC	A,$0B			; 0004EA DE 0B
 347:			; 	CALL	$0120			; 0004EC CD 20 01
 348:			; 	LD	A,$06			; 0004EF 3E 06
 349:			; 	OR	C			; 0004F1 B1
 350:			; 	LD	B,A			; 0004F2 47
 351:			; 	LD	A,$CB			; 0004F3 3E CB
 352:			; 	CALL	$01F4			; 0004F5 CD F4 01
 353:			; 	PUSH	BC			; 0004F8 C5
 354:			; 	CALL	$00BD			; 0004F9 CD BD 00
 355:			; 	POP	BC			; 0004FC C1
 356:			; 	JP	$0299			; 0004FD C3 99 02



Error + Warning report:

    24 errors
     0 warnings
    24 U -- Undeclared error

     4	passes
     0	jr promotions
   140	symbols
     0	bytes



Symbol Table:

arglp            27d     bbtrkset       =fcab+    noarg            2a9     
atrkerr          3b5     bbu0ini        =fc39+    rldrom         =fe84+    
bbcalret       =fd5a+    bbu1ini        =fc51+    rstart           3ae     
bbconin        =fd94+    bbu1rx         =fc45+    sconin         =fc2d+    
bbconout       =fd9f+    bbu1st         =fc4b+    sconout        =fc27+    
bbconst        =fdaa+    bbu1tx         =fc3f+    sconst         =fc33+    
bbcpboot       =fcc3+    bbuplchr       =fc69+    sintvec        =fff0+    
bbcrtcini      =fc03+    bbvcpmbt       =fcc9+    spnul            29c     
bbcrtfill      =fc09+    bbvoid         =fd6a+    srxrsm         =fe6c+    
bbcurset       =fc21+    bbwrvdsk       =fc7b+    srxstp         =fe68+    
bbdiv16        =fcdb+    codbeg         = 239+    syscmlo        =febf+    
bbdmaset       =fcb7+    cr             =   d+    syscom         =fc00+    
bbdprmset      =fd17+    crdureg        =fc27+    sytimr         =fe19+    
bbdriveid      =fcf3+    delay          =fd85+    tnumbf           45b     
bbdsksel       =fcbd+    dly1           =fd89+    tpa            = 100+    
bbeidck        =fd23+    dly2           =fd87+    trsta            305     
bbepmngr       =fd1d+    dostx          =fe6e+    tx0            =fe76+    
bbexec         =fd29+    drvslbf        =  4e+    tx01           =fe78+    
bbfdrvsel      =fcd5+    dsper            378     u0isr          =fe25+    
bbfhome        =fc81+    exit             384     u1isr          =fe5b+    
bbflopio       =fc93+    fcb1           =  5c+    u1nul          =fe64+    
bbfread        =fc87+    fin            =fdc4+    uastav         =fe8f+    
bbfwrite       =fc8d+    fisecn           134     uastkb         =fe91+    
bbhdboot       =fd0b+    fitrkn           132     uisre          =fe50+    
bbhdgeo        =fd05+    format           269     uisri          =fe35+    
bbhdinit       =fced+    fout           =fde1+    uusd1          = 1de+    
bbhdrd         =fcff+    fstat          =fdb5+    uusd2            45c+    
bbhdwr         =fcf9+    ftrbeg           103     vconin         =fc15+    
bbinictc       =fc57+    ftrbg2           12b     vconout        =fc0f+    
bbjtobnk       =fc00+    gcdsp            261     vconst         =fc1b+    
bbldpart       =fd11+    gchr             250     vl1              366     
bbmul16        =fce1+    hdrvsel          3be     vl2              368     
bboffcal       =fce7+    hdrvv            3d1     voidisr        =fe22+    
bbprcvblk      =fc6f+    intrdi         =fe0f+    wcmnd            375     
bbprnchr       =fc99+    intren         =fdfe+    wfdc             311     
bbpsndblk      =fc63+    lf             =   a+    wfdc1            320     
bbrdtime       =fca5+    mcfm             44d     wrngd            37e     
bbrdvdsk       =fc75+    mcmda            437     wrngt            38a     
bbresctc       =fc5d+    mfmt             40e     wsecd            31b     
bbsecset       =fcb1+    mmgetp         =fd78+    wteag            336     
bbsidset       =fccf+    mmpmap         =fd6b+    wtend            344     
bbstack        =febf+    mndrv            3d5     zsdsp            243     
bbstbase       =fe9b+    mntip            393     zsdspcl          239     
bbsttim        =fc9f+    mntrk            3f0     
