   1:			
   2:			include darkstar.equ
**** darkstar.equ ****
   1:			;****** Equ's file autogenerated by genequs ver: 1.0
   2:			;****** Input files:
   3:			;****** SysCommon.lst
   4:	FDAC          	FIN            	EQU	$FDAC
   5:	FD71          	DLY1           	EQU	$FD71
   6:	FD6F          	DLY2           	EQU	$FD6F
   7:	FDC9          	FOUT           	EQU	$FDC9
   8:	FE43          	U0ISR          	EQU	$FE43
   9:	FE34          	U1ISR          	EQU	$FE34
  10:	FD6D          	DELAY          	EQU	$FD6D
  11:	FE29          	UISRE          	EQU	$FE29
  12:	FD9D          	FSTAT          	EQU	$FD9D
  13:	FE0D          	UISRI          	EQU	$FE0D
  14:	FD11          	BBEXEC         	EQU	$FD11
  15:	FCF3          	BBHDRD         	EQU	$FCF3
  16:	FD52          	BBVOID         	EQU	$FD52
  17:	FE5F          	UASTKB         	EQU	$FE5F
  18:	FD53          	MMPMAP         	EQU	$FD53
  19:	FDF7          	INTRDI         	EQU	$FDF7
  20:	FC2D          	SCONIN         	EQU	$FC2D
  21:	FC15          	VCONIN         	EQU	$FC15
  22:	FCCF          	BBDIV16        	EQU	$FCCF
  23:	FCED          	BBHDWR         	EQU	$FCED
  24:	FD60          	MMGETP         	EQU	$FD60
  25:	FDE6          	INTREN         	EQU	$FDE6
  26:	FE52          	RLDROM         	EQU	$FE52
  27:	FCD5          	BBMUL16        	EQU	$FCD5
  28:	FC00          	SYSCOM         	EQU	$FC00
  29:	FE5D          	UASTAV         	EQU	$FE5D
  30:	FE01          	SYTIMR         	EQU	$FE01
  31:	FC33          	SCONST         	EQU	$FC33
  32:	FC1B          	VCONST         	EQU	$FC1B
  33:	FC75          	BBFREAD        	EQU	$FC75
  34:	FD0B          	BBEIDCK        	EQU	$FD0B
  35:	FCF9          	BBHDGEO        	EQU	$FCF9
  36:	FE8D          	BBSTACK        	EQU	$FE8D
  37:	FC6F          	BBFHOME        	EQU	$FC6F
  38:	FD7C          	BBCONIN        	EQU	$FD7C
  39:	FC27          	CRDUREG        	EQU	$FC27
  40:	FFF0          	SINTVEC        	EQU	$FFF0
  41:	FE8D          	SYSCMLO        	EQU	$FE8D
  42:	FE0A          	VOIDISR        	EQU	$FE0A
  43:	FC8D          	BBSTTIM        	EQU	$FC8D
  44:	FD92          	BBCONST        	EQU	$FD92
  45:	FC27          	SCONOUT        	EQU	$FC27
  46:	FC0F          	VCONOUT        	EQU	$FC0F
  47:	FCDB          	BBOFFCAL       	EQU	$FCDB
  48:	FC45          	BBINICTC       	EQU	$FC45
  49:	FE69          	BBSTBASE       	EQU	$FE69
  50:	FC4B          	BBRESCTC       	EQU	$FC4B
  51:	FC93          	BBRDTIME       	EQU	$FC93
  52:	FCB1          	BBCPTIME       	EQU	$FCB1
  53:	FD42          	BBCALRET       	EQU	$FD42
  54:	FCA5          	BBDMASET       	EQU	$FCA5
  55:	FC00          	BBJTOBNK       	EQU	$FC00
  56:	FCAB          	BBDSKSEL       	EQU	$FCAB
  57:	FCE1          	BBHDINIT       	EQU	$FCE1
  58:	FC9F          	BBSECSET       	EQU	$FC9F
  59:	FCFF          	BBHDBOOT       	EQU	$FCFF
  60:	FC57          	BBUPLCHR       	EQU	$FC57
  61:	FC87          	BBPRNCHR       	EQU	$FC87
  62:	FCBD          	BBVCPMBT       	EQU	$FCBD
  63:	FC81          	BBFLOPIO       	EQU	$FC81
  64:	FD05          	BBEPMNGR       	EQU	$FD05
  65:	FCC3          	BBSIDSET       	EQU	$FCC3
  66:	FC63          	BBRDVDSK       	EQU	$FC63
  67:	FC7B          	BBFWRITE       	EQU	$FC7B
  68:	FCB7          	BBCPBOOT       	EQU	$FCB7
  69:	FC21          	BBCURSET       	EQU	$FC21
  70:	FC99          	BBTRKSET       	EQU	$FC99
  71:	FC69          	BBWRVDSK       	EQU	$FC69
  72:	FD87          	BBCONOUT       	EQU	$FD87
  73:	FCE7          	BBDRIVEID      	EQU	$FCE7
  74:	FC51          	BBPSNDBLK      	EQU	$FC51
  75:	FC03          	BBCRTCINI      	EQU	$FC03
  76:	FC5D          	BBPRCVBLK      	EQU	$FC5D
  77:	FC09          	BBCRTFILL      	EQU	$FC09
  78:	FCC9          	BBFDRVSEL      	EQU	$FCC9
  79:	FC3F          	BBINIUART      	EQU	$FC3F
  80:	FC39          	BBSELUART      	EQU	$FC39
  81:			;****** EOF ***
**** wrlba.asm ****
   3:			
   4:				.Z80
   5:				ASEG
   6:			
   7:			
   8:	0100          		ORG	$100
   9:			
  10:	0100  00      	BEGIN:	NOP
  11:	0101  00      		NOP
  12:	0102  210000  		LD	HL,0
  13:	0105  0E00    		LD	C,0
  14:			
  15:	0107  E5      	CALR:	PUSH	HL
  16:	0108  C5      		PUSH	BC
  17:	0109  CD6901  		CALL	HL2ASCB
  18:	010C  C1      		POP	BC
  19:	010D  E1      		POP	HL
  20:			
  21:	010E  E5      		PUSH	HL
  22:	010F  C5      		PUSH	BC
  23:	0110  79      		LD	A,C
  24:	0111  CD5001  		CALL	H2AJ1
  25:	0114  CD6C01  		CALL	SPACER
  26:	0117  C1      		POP	BC
  27:	0118  E1      		POP	HL
  28:			
  29:	0119  E5      		PUSH	HL
  30:	011A  C5      		PUSH	BC
  31:	011B  CD2C01  		CALL	WRLBA
  32:	011E  C1      		POP	BC
  33:	011F  E1      		POP	HL
  34:	0120  79      		LD	A,C
  35:	0121  3C      		INC	A
  36:	0122  FE40    		CP	64
  37:	0124  4F      		LD	C,A
  38:	0125  38E0    		JR	C,CALR
  39:	0127  0E00    		LD	C,0
  40:	0129  23      		INC	HL
  41:	012A  18DB    		JR	CALR
  42:			
  43:	012C          	WRLBA:
  44:			; 	LD	HL,(@TRK)	;Get CPM requested Track Hi&Lo
  45:	012C  2600    		LD	H,00H		;zero high track byte
  46:	012E  7D      		LD	A,L		;load low track byte to accumulator
  47:	012F  FE00    		CP	00H		;check for 0 track and skip track loop
  48:	0131  CA3901  		JP	Z,LBASEC
  49:	0134  0606    		LD	B,06H		;load counter to shift low track value 6 places to left i.e X 64
  50:	0136          	LBATRK:
  51:	0136  29      		ADD	HL,HL		;Add HL to itself 6 times to multiply by 64
  52:	0137  10FD    		DJNZ	LBATRK		;loop around 6 times i.e x 64
  53:			
  54:	0139          	LBASEC:
  55:			; 	LD	A,(@SECT)	;Get CPM requested sector
  56:	0139  79      		LD	A,C		;Get CPM requested sector
  57:	013A  85      		ADD	A,L		;Add value in L to sector info in A
  58:	013B  D23F01  		JP	NC,LBAOFF	;If no carry jump to lba offset correction
  59:	013E  24      		INC	H		;carry one over to H
  60:	013F          	LBAOFF:
  61:	013F  6F      		LD	L,A		;copy accumulator to L
  62:	0140  2B      		DEC	HL		;decrement 1 from the HL register pair
  63:				;HL should now contain correct LBA value
  64:			
  65:	0141  CD6901  		CALL	HL2ASCB
  66:	0144  CD8B01  		CALL	OUTCRLF
  67:	0147  CD7CFD  		CALL	BBCONIN
  68:			
  69:			; 	LD	D,0		;Send 0 for upper cyl value
  70:			; 	LD	E,REGCYLINDERMSB
  71:			; 	CALL	IDEWR8D		;Send info to drive
  72:			;
  73:			; 	LD	D,H		;load lba high byte to D from H
  74:			; 	LD	E,REGCYLINDERLSB
  75:			; 	CALL	IDEWR8D		;Send info to drive
  76:			;
  77:			; 	LD	D,L		;load lba low byte to D from L
  78:			; 	LD	E,REGSECTOR
  79:			; 	CALL	IDEWR8D		;Send info to drive
  80:			; 	LD	D,1		;For now, one sector at a time
  81:			; 	LD	E,REGSECCNT
  82:			; 	CALL	IDEWR8D
  83:			
  84:	014A  C9      		RET
  85:			;==============================================================================
  86:	014B          	HL2ASC:
  87:			
  88:	014B  7C      	H2AEN1:	LD	A,H
  89:	014C  CD5001  		CALL	H2AJ1
  90:	014F  7D      		LD	A,L
  91:	0150  F5      	H2AJ1:	PUSH	AF
  92:	0151  0F      		RRCA
  93:	0152  0F      		RRCA
  94:	0153  0F      		RRCA
  95:	0154  0F      		RRCA
  96:	0155  CD5901  		CALL	H2AJ2
  97:	0158  F1      		POP	AF
  98:	0159  CD7201  	H2AJ2:	CALL	NIB2ASC
  99:	015C  CD87FD  		CALL	BBCONOUT
 100:	015F  C9      		RET
 101:			
 102:	0160  CD5001  	H2AJ3:	CALL	H2AJ1           ; entry point to display HEX and a "-"
 103:	0163          	MPROMPT:
 104:	0163  0E2D    		LD	C,$2D
 105:	0165  CD87FD  		CALL	BBCONOUT
 106:	0168  C9      		RET
 107:			
 108:			
 109:			
 110:			;;
 111:			;; HL2ASCB - convert & display HL 2 ascii leave a blank after
 112:	0169          	HL2ASCB:
 113:	0169  CD4B01  		CALL	HL2ASC           ; was 00FA63 CD 46 FA
 114:	016C  0E20    	SPACER:	LD	C,$20
 115:	016E  CD87FD  		CALL	BBCONOUT
 116:	0171  C9      		RET
 117:			
 118:	0172          	NIB2ASC:
 119:	0172  E60F    		AND	$0F             ; was 00FDE0 E6 0F
 120:	0174  C690    		ADD	A,$90
 121:	0176  27      		DAA
 122:	0177  CE40    		ADC	A,$40
 123:	0179  27      		DAA
 124:	017A  4F      		LD	C,A
 125:	017B  C9      		RET
 126:			
 127:	017C          	OUTSTR:
 128:	017C  C5      		PUSH	BC
 129:	017D  4E      	OSLP0:	LD	C,(HL)
 130:	017E  41      		LD	B,C
 131:	017F  CBB9    		RES	7,C
 132:	0181  CD87FD  		CALL	BBCONOUT
 133:	0184  23      		INC	HL
 134:	0185  78      		LD	A,B
 135:	0186  07      		RLCA
 136:	0187  30F4    		JR	NC,OSLP0
 137:	0189  C1      		POP	BC
 138:	018A  C9      		RET
 139:			
 140:			
 141:			;; OUTCRLF - CR/LF through OUTSTR
 142:			;
 143:			
 144:	018B          	OUTCRLF:
 145:	018B  E5      		PUSH	HL			; was 00FAB0 E5
 146:	018C  219401  	OCRLF1:	LD	HL,CRLFTAB
 147:	018F  CD7C01  		CALL	OUTSTR
 148:	0192  E1      		POP	HL
 149:	0193  C9      		RET
 150:			
 151:	0194          	CRLFTAB:
 152:	0194  0D8A    		DB	$0D,$8A



Statistics:

     4	passes
     0	jr promotions
    97	symbols
     0	bytes



Symbol Table:

bbcalret       =fd42+    bbpsndblk      =fc51+    lbaoff           13f     
bbconin        =fd7c+    bbrdtime       =fc93+    lbasec           139     
bbconout       =fd87+    bbrdvdsk       =fc63+    lbatrk           136     
bbconst        =fd92+    bbresctc       =fc4b+    mmgetp         =fd60+    
bbcpboot       =fcb7+    bbsecset       =fc9f+    mmpmap         =fd53+    
bbcptime       =fcb1+    bbseluart      =fc39+    mprompt          163+    
bbcrtcini      =fc03+    bbsidset       =fcc3+    nib2asc          172     
bbcrtfill      =fc09+    bbstack        =fe8d+    ocrlf1           18c+    
bbcurset       =fc21+    bbstbase       =fe69+    oslp0            17d     
bbdiv16        =fccf+    bbsttim        =fc8d+    outcrlf          18b     
bbdmaset       =fca5+    bbtrkset       =fc99+    outstr           17c     
bbdriveid      =fce7+    bbuplchr       =fc57+    rldrom         =fe52+    
bbdsksel       =fcab+    bbvcpmbt       =fcbd+    sconin         =fc2d+    
bbeidck        =fd0b+    bbvoid         =fd52+    sconout        =fc27+    
bbepmngr       =fd05+    bbwrvdsk       =fc69+    sconst         =fc33+    
bbexec         =fd11+    begin            100+    sintvec        =fff0+    
bbfdrvsel      =fcc9+    calr             107     spacer           16c     
bbfhome        =fc6f+    crdureg        =fc27+    syscmlo        =fe8d+    
bbflopio       =fc81+    crlftab          194     syscom         =fc00+    
bbfread        =fc75+    delay          =fd6d+    sytimr         =fe01+    
bbfwrite       =fc7b+    dly1           =fd71+    u0isr          =fe43+    
bbhdboot       =fcff+    dly2           =fd6f+    u1isr          =fe34+    
bbhdgeo        =fcf9+    fin            =fdac+    uastav         =fe5d+    
bbhdinit       =fce1+    fout           =fdc9+    uastkb         =fe5f+    
bbhdrd         =fcf3+    fstat          =fd9d+    uisre          =fe29+    
bbhdwr         =fced+    h2aen1           14b+    uisri          =fe0d+    
bbinictc       =fc45+    h2aj1            150     vconin         =fc15+    
bbiniuart      =fc3f+    h2aj2            159     vconout        =fc0f+    
bbjtobnk       =fc00+    h2aj3            160+    vconst         =fc1b+    
bbmul16        =fcd5+    hl2asc           14b     voidisr        =fe0a+    
bboffcal       =fcdb+    hl2ascb          169     wrlba            12c     
bbprcvblk      =fc5d+    intrdi         =fdf7+    
bbprnchr       =fc87+    intren         =fde6+    
