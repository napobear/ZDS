//
//  '########'########::'######:::'##::: ##'########'########:'#######:::'#####:::
//  ..... ##: ##.... ##'##... ##:: ###:: ## ##.....:..... ##:'##.... ##:'##.. ##::
//  :::: ##:: ##:::: ## ##:::..::: ####: ## ##:::::::::: ##:: ##:::: ##'##:::: ##:
//  ::: ##::: ##:::: ##. ######::: ## ## ## ######::::: ##:::: #######: ##:::: ##:
//  :: ##:::: ##:::: ##:..... ##:: ##. #### ##...::::: ##::::'##.... ## ##:::: ##:
//  : ##::::: ##:::: ##'##::: ##:: ##:. ### ##::::::: ##::::: ##:::: ##. ##:: ##::
//   ######## ########:. ######::: ##::. ## ######## ########. #######::. #####:::
//  ........:........:::......::::..::::..:........:........::.......::::.....::::
//
//  Sysbios C interface library
//  P.Betti  <pbetti@lpconsul.eu>
//
//  Module: c_bios header
//
//  HISTORY:
//  -[Date]- -[Who]------------- -[What]---------------------------------------
//  27.09.18 Piergiorgio Betti   Creation date
//


#include <cpm.h>

#define	FILL	{0}, {{' '},{' '},{' '},{' '},{' '},{' '},{' '},{' '}}, {{' '},{' '},{' '}}, {0}, \
		{{0},{0}}, {0}, {{0},{0},{0},{0},{0},{0},{0},{0},{0},{0},{0},{0},{0},{0},{0},{0}}, {0}, {{0},{0},{0}}, {0}, {U_CON}, {0}

struct fcb	_fcb[MAXFILE] =
{
	{ FILL },	/* stdin */
	{ FILL },	/* stdout */
	{ FILL },	/* stderr */
};

char    _sibuf[BUFSIZ];
FILE    _iob[_NFILE] =
{
	{
		{_sibuf},
		{0},
		{_sibuf},
		{_IOREAD|_IOMYBUF},
		{0}                       /* stdin */
	},
	{
		{(char *)0},
		{0},
		{(char *)0},
		{_IOWRT|_IONBF},
		{1}                       /* stdout */
	},
	{
		{(char *)0},
		{0},
		{(char *)0},
		{_IOWRT|_IONBF},
		{2}                       /* stderr */
	},
};

void _cpm_clean()
{
	uint8_t i;

	i = 0;
	do
		close(i);
	while(++i < MAXFILE);
}

void _putrno(uint8_t * where, int32_t rno)
{
	where[0] = rno & 0xFF;
	where[1] = (rno >> 8) & 0xFF;
	where[2] = (rno >> 16) & 0xFF;
}

